---
import SectionWork from '../SectionWork.astro'
import { isNewJob, getWorkPeriod, getWorkDuration } from '../../utils/dateUtils'
import { getLangFromUrl, useTranslations } from '../../i18n/utils'

interface Props {
  workExperience: any[]
}

const { workExperience } = Astro.props
const langName = getLangFromUrl(Astro.url)
const t = useTranslations(langName)
---

<section class="pt-8 md:pt-0 pb-6 md:pb-10">
  <div class="max-w-7xl mx-auto px-4 md:grid md:grid-cols-12 md:gap-x-8 md:gap-y-1 print:mt-12">
    <div class="md:col-span-3 mb-2">
      <h2 class="text-gray-800 dark:text-gray-200 uppercase md:text-right">{t('experience')}</h2>
    </div>
    <div class="md:col-span-9 mb-2 hidden md:block"></div>
    {
      workExperience.map((e) =>
        e.pagebreak ? (
          <p class="pagebreak md:col-span-12" />
        ) : (
          <div class="contents md:col-span-12">
            <div class="md:col-span-3 md:text-right print:mt-12">
              <h4 class="font-bold sm:text-[1.1em] text-2xl text-gray-700 dark:text-gray-300 leading-tight whitespace-nowrap overflow-hidden text-ellipsis">
                {e.work}
              </h4>
            </div>
            <div class="md:col-span-9 hidden md:block print:mt-12" />
            {(Array.isArray(e.level) ? e.level : []).map((j) => (
              <>
                <div class="md:col-span-3 mb-2 md:mb-0 md:mt-3 mt-6 md:text-right">
                  <small class="flex xl:flex-row flex-col xs:flex-row justify-end gap-1 mb-1 text-[11px] font-medium text-gray-600 dark:text-gray-400 tracking-wide uppercase">
                    <span>{getWorkPeriod(j, langName, t)}</span>
                    <span>{getWorkDuration(j, langName, t)}</span>
                  </small>
                  <h3 class="font-semibold text-gray-800 dark:text-gray-200 uppercase tracking-wide leading-snug ">{j.job}</h3>
                  {isNewJob(j.begin) && (
                    <span class="inline-block mt-1 text-[10px] font-semibold tracking-wide rounded bg-green-100 text-green-700 dark:bg-green-800/40 dark:text-green-300 px-1.5 py-0.5 uppercase">
                      {t('experience.newjob')}
                    </span>
                  )}
                </div>
                <article class="md:col-span-9 relative group mb-0 last:mb-8">
                  <div class=" text-gray-700 dark:text-gray-300 leading-relaxed">
                    <SectionWork filename={j.file} />
                  </div>
                </article>
              </>
            ))}
          </div>
        ),
      )
    }
  </div>
</section>
<style>
  .pagebreak {
    margin: 0px;
    page-break-before: always;
  }
</style>
